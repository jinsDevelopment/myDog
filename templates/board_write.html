{% extends 'layout.html' %} {% block content %}
<script src="https://cdn.jsdelivr.net/npm/bs-custom-file-input/dist/bs-custom-file-input.js"></script>
<script>
  $(document).ready(function () {
    bsCustomFileInput.init();
  });

  function board_save() {
    let title = $('#title').val();
    let contents = $('#contents').val();

    if (title == '') {
      alert('ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”.');
      return;
    }
    if (contents == '') {
      alert('ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”');
      return;
    }

    let file = $('#file')[0].files[0];
    let form_data = new FormData();

    form_data.append('file', file);
    form_data.append('title', title);
    form_data.append('contents', contents);
    form_data.append('userid', '{{user_id}}');

    $.ajax({
      type: 'POST',
      url: '/board/create',
      data: form_data,
      cache: false,
      contentType: false,
      processData: false,
      success: function (response) {
        alert(response['msg']);
        window.location.href = '/board/select';
      },
    });
  }

  function fileCheck() {
    if ($('#file')[0].files.length == 0) {
      return;
    }

    let filename = $('#file')[0].files[0].name;
    let pathpoint = filename.lastIndexOf('.');
    let filepoint = filename.substring(pathpoint + 1, filename.length);
    let filetype = filepoint.toLowerCase();

    if (
      filetype == 'jpg' ||
      filetype == 'gif' ||
      filetype == 'png' ||
      filetype == 'jpeg' ||
      filetype == 'bmp'
    ) {
    } else {
      alert('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
      $('#file').val('');
      return;
    }
  }

  function goBack() {
    window.history.back();
  }
</script>
<body>
  <div class="jumbotron jumbotron-fluid">
    <div class="container board_write_wrap">
      <div class="posting-box">
        <header class="board_write_header">
          ì‚¬ì†Œí•œ ê²ƒë„ ì¢‹ì•„ìš”. ì˜¤ëŠ˜ì€ ë¬´ìŠ¨ ì¼ì´ ìˆìœ¼ì…¨ë‚˜ìš”? ğŸ˜
        </header>
        <div class="write-form">
          <div class="custom-file">
            <input
              type="file"
              id="file"
              class="custom-file-input"
              onchange="fileCheck()"
              accept="image/gif,image/jpeg,image/png"
            />
          </div>
          <div class="form-group">
            <label for="exampleFormControlInput1" class="blind">ì œëª©</label>
            <input
              type="text"
              class="form-control"
              id="title"
              maxlength="20"
              placeholder="ì œëª©"
            />
          </div>
          <div class="form-group">
            <label for="exampleFormControlTextarea1" class="blind">ë‚´ìš©</label>
            <textarea
              class="form-control"
              id="contents"
              maxlength="800"
              rows="20"
              placeholder="ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš” ğŸ‘"
            ></textarea>
          </div>
          <div class="form-group btn-write-form">
            <button class="btn btn-primary" onclick="board_save()">ì €ì¥</button>
            <button class="btn btn-primary" onclick="goBack()">ì·¨ì†Œ</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>
{% endblock %}
